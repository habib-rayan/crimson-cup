{%- assign s = section.settings -%}
{%- assign product_handle = product.handle -%}
{%- assign product_limit = 4 -%}

<section class="section related-product color-{{ s.color_scheme }}" id="section_{{ section.id }}">
    <div class="container">
        <div class="related-product-top">
            <h2 class="related-heading wow animate__animated animate__fadeInUp"
                data-wow-duration="1s" data-wow-delay=".1s"> {{ s.heading }} 
            </h2>
        </div>

        <div class="related-product-items">
            {% for collection in product.collections %}
                {% for product in collection.products  %}
                    {% unless product.handle == product_handle %}
                    {% assign product_limit = product_limit | plus: 1 %}
                    {% if product_limit <= 8 %}
                        {%- render 'product-card', product: product -%}
                    {% endif %}
                    {% endunless %}
                {% endfor %}
            {% endfor %}  
        </div>
    </div>
</section>

{%- style -%}
    {%- if s.background !=blank -%}
    #section_{{ section.id }} {
            background-image: url({{ s.background |  image_url: width:3000  }});
            background-position: center;
            background-size: cover;
            background-repeat: no-repeat;
        }
    {%- endif -%}
{%- endstyle -%}

{% schema %}
    {
      "name": "Products",
      "settings": [
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default" : "You may also like"
        },
        
        {
          "type": "image_picker",
          "id": "background",
          "label": "Background"
        },
        {
          "type": "header",
          "content": "Color"
        },
        {
          "type": "color_scheme",
          "id": "color_scheme",
          "label": "Color Scheme",
          "default" : "scheme-1"
        }
      ],
      "presets": [
        {
          "name": "Related Product",
          "settings": {
          }
        }
      ]
    }
  {% endschema %}